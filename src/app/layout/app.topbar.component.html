<div class="layout-topbar">
    <button #menubutton class="p-link layout-menu-button layout-topbar-button" (click)="layoutService.onMenuToggle()">
        <i class="pi pi-bars"></i>
    </button>

    <a class="layout-topbar-logo" routerLink="">
        <img src="assets/layout/images/Logo-parisina-Login-menú.png" alt="logo">
        <span></span>
    </a>

    <button #topbarmenubutton class="p-link layout-topbar-menu-button layout-topbar-button"
        (click)="layoutService.showProfileSidebar()">
        <i class="pi pi-ellipsis-v"></i>
    </button>

    <div #topbarmenu class="layout-topbar-menu"
        [ngClass]="{'layout-topbar-menu-mobile-active': layoutService.state.profileSidebarVisible}">

        <button *ngIf="datosUsuario && (datosUsuario.rol_usuario === undefined || datosUsuario.rol_usuario === '654a96ebdbe2126f5a74161e')" 
        type="button" icon="pi pi-shopping-cart" pButton label="{{productosCarrito.length}}" (click)="op2.toggle($event)" class="p-button-text p-button-lg ml-4"></button>
                <p-overlayPanel #op2 [showCloseIcon]="false" [style]="{width: '60%'}">
                    <ng-template pTemplate>
                        <p-toolbar styleClass="mb-4">
                            <ng-template pTemplate="left">
                                <button pButton type="button" [routerLink]="['/pedidoCliente']" label="Hacer pedido" class="p-button-text p-button-lg ml-4"></button>
                            </ng-template>
                    
                            <ng-template pTemplate="right">
                                <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: -20px;">
                                  <h5 class="mb-0">Total pedido:</h5>
                                  <h5 class="mt-2">{{totalCarrito | number}}</h5>
                                </div>
                              </ng-template>
                              
                        </p-toolbar>
                        
                        <p-table [value]="productosCarrito" selectionMode="single" [(selection)]="selectedProduct" (onRowSelect)="op2.hide()" responsiveLayout="scroll">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="min-width:12rem">Producto</th>
                                    <th style="max-width:8rem">Precio Und</th>
                                    <th style="max-width:8rem">Cantidad</th>
                                    <th style="min-width:8rem">Precio Total</th>
                                    <th style="max-width:3rem">Borrar</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-product>
                                <tr [pSelectableRow]="rowData">
                                    <td>{{product.nombre_producto}}</td>
                                    <td>{{tipoCliente === 'Persona jurídica' ? (product.precio_por_mayor_ico | number) : (product.precio_ico | number)}}</td>
                                    <td>{{product.cantidad_producto}}</td>
                                    <td>{{product.precio_total_producto | number}}</td>
                                    <td><button
                                        pButton
                                        pRipple
                                        icon="pi pi-times"
                                        class="p-button-rounded p-button-danger mr-2"
                                        (click)="eliminarProductoCarrito(product)"
                                    ></button></td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </ng-template>
                </p-overlayPanel>

        <button class="p-link layout-topbar-button" (click)="perfil()" pTooltip="Ver mi perfil" tooltipPosition="left">
            <i class="pi pi-user"></i>
            <span>Mi perfil</span>
        </button>
        <button class="p-link layout-topbar-button" (click)="logout()" pTooltip="Cerrar sesión" tooltipPosition="left">
            <i class="pi pi-sign-out"></i>
            <span>Cerrar sesión</span>
        </button>
    </div>
</div>

<p-dialog [(visible)]="confirmarCerrarSesionDialog" header="Confirmar para cerrar la sesión" [modal]="true"
    [style]="{width:'450px'}">
    <div class="flex align-items-center justify-content-center">
        <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
        <span>¿Está seguro de que desea cerrar sesión?</span>
    </div>
    <ng-template pTemplate="footer">
        <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No" (click)="noCerrarSesion()"></button>
        <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Si" (click)="cerrarSesion()"></button>
    </ng-template>
</p-dialog>