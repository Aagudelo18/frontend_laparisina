<div class="card">
    <p-toast></p-toast>
    <h1>CREAR PEDIDO</h1>
    <div class="grid p-fluid mt-3">
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="documento_cliente"
                    pInputText
                    (change)="getCliente(pedido.documento_cliente)"
                    [(ngModel)]="pedido.documento_cliente"
                />
                <label for="inputtext">Cedula</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="tipo_cliente"
                    pInputText
                    [(ngModel)]="pedido.tipo_cliente"
                />
                <label for="inputtext">Tipo de Cliente</label>
            </span>
        </div>
        <div
            class="field col-12 md:col-3"
            *ngIf="pedido.tipo_cliente === 'Empresa'"
        >
            <span class="p-float-label">
                <input
                    type="text"
                    id="nit_empresa_cliente"
                    pInputText
                    [(ngModel)]="pedido.nit_empresa_cliente"
                />
                <label for="inputtext">NIT Empresa</label>
            </span>
        </div>
        <div
            class="field col-12 md:col-3"
            *ngIf="pedido.tipo_cliente === 'Empresa'"
        >
            <span class="p-float-label">
                <input
                    type="text"
                    id="nombre_juridico"
                    pInputText
                    [(ngModel)]="pedido.nombre_juridico"
                />
                <label for="inputtext">Nombre Empresa</label>
            </span>
        </div>
        <div
            class="field col-12 md:col-3"
            *ngIf="pedido.tipo_cliente === 'Persona natural'"
        >
            <span class="p-float-label">
                <input
                    type="text"
                    id="nombre_contacto"
                    pInputText
                    [(ngModel)]="pedido.nombre_contacto"
                />
                <label for="inputtext">Nombre cliente</label>
            </span>
        </div>
        <div
            class="field col-12 md:col-3"
            *ngIf="pedido.tipo_cliente === 'Persona natural'"
        >
            <span class="p-float-label">
                <input
                    type="text"
                    id="quien_recibe"
                    pInputText
                    [(ngModel)]="pedido.quien_recibe"
                />
                <label for="inputtext">Quien Recibe</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="telefono_cliente"
                    pInputText
                    [(ngModel)]="pedido.telefono_cliente"
                />
                <label for="inputtext">Telefono</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="direccion_entrega"
                    pInputText
                    [(ngModel)]="pedido.direccion_entrega"
                />
                <label for="inputtext">Dirección</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="ciudad_cliente"
                    pInputText
                    [(ngModel)]="pedido.ciudad_cliente"
                />
                <label for="inputtext">Ciudad</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="barrio_cliente"
                    pInputText
                    [(ngModel)]="pedido.barrio_cliente"
                />
                <label for="inputtext">Barrio</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-calendar
                    inputId="calendar"
                    [(ngModel)]="pedido.fecha_entrega_pedido"
                ></p-calendar>
                <label for="calendar">Fecha Entrega</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-dropdown
                    inputId="dropdown"
                    id="metodo_pago"
                    [autoDisplayFirst]="false"
                    [options]="metodoPago"
                    [(ngModel)]="pedido.metodo_pago"
                ></p-dropdown>
                <label for="dropdown">Metodo de Pago</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-inputNumber
                    inputId="valor_domicilio"
                    [(ngModel)]="pedido.valor_domicilio"
                    (input)="calcularPrecioTotalVenta()"
                >
                </p-inputNumber>
                <label for="valor_domicilio">Valor Domicilio</label>
            </span>
        </div>
    </div>

    <div *ngIf="pedido.tipo_cliente == 'Empresa' || pedido.tipo_cliente == 'Persona natural'" class="grid p-fluid mt-3">
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <select
                    class="p-element p-inputtext ng-star-inserted"
                    [(ngModel)]="categoriaSeleccionada"
                    (ngModelChange)="categoriaOnChange()"
                >
                    <option
                        *ngFor="let categoria of categorias"
                        [value]="categoria.nombre_categoria_producto"
                    >
                        {{ categoria.nombre_categoria_producto }}
                    </option>
                </select>
                <label for="categoria" style="margin-top: -40px"
                    >Categoría</label
                >
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-dropdown
                    inputId="productosCategoria"
                    [autoDisplayFirst]="false"
                    [options]="productosCategoria"
                    [(ngModel)]="productoSeleccionado"
                    optionLabel="nombre_producto"
                ></p-dropdown>
                <label for="productos">Productos</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-inputNumber
                    inputId="integeronly"
                    [(ngModel)]="cantidad_producto"
                >
                </p-inputNumber>
                <label htmlFor="number-input">Cantidad</label>
            </span>
        </div>

        <div class="field col-12 md:col-3">
            <button
                pButton
                pRipple
                label="Agregar Producto"
                icon="pi pi-user-plus"
                class="p-button-success mr-2"
                (click)="agregarProductoExistente()"
            ></button>
        </div>
    </div>
    <!-- #tabla productos -->
    <div class="grid p-fluid mt-3">
        <p-table [value]="productsFormArray.controls">
            <ng-template pTemplate="header">
                <tr>
                    <th colspan="12">Lista de Productos</th>
                </tr>
                <tr>
                    <th>Nombre Producto</th>
                    <th>Categoria</th>
                    <th>cantidad</th>
                    <th>Precio Unitario</th>
                    <th>SubTotal</th>
                    <th>Accion</th>
                    <!-- Agrega una columna para los botones de eliminación -->
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
                <tr>
                    <td>{{ product.get("nombre_producto")?.value }}</td>
                    <td>{{ product.get("nombre_categoria_producto")?.value }}</td>
                    <td>{{ product.get("cantidad_producto")?.value }}</td>                   
                    <td>
                        {{ pedido.tipo_cliente == 'Empresa' ? product.get("precio_por_mayor_ico")?.value : product.get("precio_ico")?.value }}
                    </td>                  
                    <td>{{ product.get("precio_total_producto")?.value }}</td>
                    <td>
                        <button pButton pRipple icon="pi pi-times" class="p-button-rounded p-button-danger mr-2" (click)="eliminarProducto(product)" style=" width: 2.5rem; height: 2.5rem; "></button>
                    </td>
                </tr>
                <br />
            </ng-template>
        </p-table>
    </div>
    <br /><br />
    <div class="formgrid grid justify-end">
        <div class="field col-6 md:col-3">
            <span class="p-float-label">
                <p-inputNumber
                    inputId="subtotal_venta"
                    [(ngModel)]="pedido.subtotal_venta"
                    readonly="true"
                >
                </p-inputNumber>
                <label for="subtotal_venta">Subtotal Venta</label>
            </span>
        </div>

        <div class="field col-6 md:col-3">
            <span class="p-float-label">
                <p-inputNumber
                    inputId="precio_total_venta"
                    [(ngModel)]="pedido.precio_total_venta"
                    readonly="true"
                >
                </p-inputNumber>
                <label for="precio_total_venta">Precio Total Venta</label>
            </span>
        </div>
    </div>

    <div class="my-2">
        <button
            pButton
            pRipple
            label="Crear Pedido"
            icon="pi pi-user-plus"
            class="p-button-success mr-2"
            (click)="crearPedido()"
        ></button>
        <button
            pButton
            pRipple
            label="Cancelar"
            icon="pi pi-user-plus"
            class="p-button-danger mr-2"
            (click)="cancelarCreacion()"         
        ></button>
    </div>
</div>
