<div class="card">
    <h1>CREAR PEDIDO</h1>
    <div class="grid p-fluid mt-3">
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="nombre_cliente"
                    pInputText
                    [(ngModel)]="pedido.nombre_cliente"
                />
                <label for="inputtext">Nombre cliente</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="nombre_cliente"
                    pInputText
                    [(ngModel)]="pedido.quien_recibe"
                />
                <label for="inputtext">Nombre Quien Recibe</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="number"
                    id="telefono"
                    pInputText
                    [(ngModel)]="pedido.telefono_cliente"
                />
                <label for="inputtext">Telefono</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="direccion"
                    pInputText
                    [(ngModel)]="pedido.direccion_entrega"
                />
                <label for="inputtext">Dirección</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-dropdown
                    inputId="dropdown"
                    [autoDisplayFirst]="false"
                    [options]="locacionesEntrega"
                    [(ngModel)]="pedido.edificio_apto_barrio"
                    optionLabel="name"
                ></p-dropdown>
                <label for="dropdown">Lugar de Entrega</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <input
                    type="text"
                    id="ciudad"
                    pInputText
                    [(ngModel)]="pedido.ciudad"
                />
                <label for="inputtext">Ciudad</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-calendar
                    inputId="calendar"
                    [(ngModel)]="pedido.fecha_entrega_pedido"
                    [dateFormat]="'dd/mm/yy'"
                ></p-calendar>
                <label for="calendar">Fecha Entrega</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-dropdown
                    inputId="dropdown"
                    [autoDisplayFirst]="false"
                    [options]="metodoPago"
                    [(ngModel)]="pedido.metodo_pago"
                    optionLabel="name"
                ></p-dropdown>
                <label for="dropdown">Metodo de Pago</label>
            </span>
        </div>
    </div>

    <div class="grid p-fluid mt-3">
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <select
                    class="p-element p-inputtext ng-star-inserted"
                    [(ngModel)]="categoriaSeleccionada"
                    (ngModelChange)="categoriaOnChange()"
                >
                    <option
                        *ngFor="let categoria of categorias"
                        [value]="categoria.nombre_categoria_producto"
                    >
                        {{ categoria.nombre_categoria_producto }}
                    </option>
                </select>
                <label for="categoria" style="margin-top: -40px"
                    >Categoría</label
                >
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-dropdown
                    inputId="productosCategoria"
                    [autoDisplayFirst]="false"
                    [options]="productosCategoria"
                    [(ngModel)]="productoSeleccionado"
                    optionLabel="nombre_producto"
                ></p-dropdown>
                <label for="productos">Productos</label>
            </span>
        </div>
        <div class="field col-12 md:col-3">
            <span class="p-float-label">
                <p-inputNumber
                    inputId="integeronly"
                    [(ngModel)]="cantidad_producto"
                >
                </p-inputNumber>
                <label htmlFor="number-input">Cantidad</label>
            </span>
        </div>

        <div class="field col-12 md:col-3">
            <button
                pButton
                pRipple
                label="Agregar Producto"
                icon="pi pi-user-plus"
                class="p-button-success mr-2"
                (click)="agregarProductoExistente()"
            ></button>
        </div>
    </div>
    <div class="grid p-fluid mt-3">
        <!-- #tabla productos -->
        <p-table [value]="productsFormArray.controls">
            <ng-template pTemplate="header">
                <tr>
                    <th colspan="12">Lista de Productos</th>
                </tr>
                <tr>
                    <th>Nombre Producto</th>
                    <th>Categoria</th>
                    <th>cantidad</th>
                    <th>Precio Unitario</th>
                    <th>SubTotal</th>
                    <th>Accion</th>
                    <!-- Agrega una columna para los botones de eliminación -->
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
                <tr>
                    <td>{{ product.get('nombre_producto')?.value }}</td>
                    <td>{{ product.get('nombre_categoria_producto')?.value }}</td>
                    <td>{{ product.get('cantidad_producto')?.value}}</td>
                    <td>{{ product.get('precio_ico')?.value}}</td>
                    <td>{{ product.get('precio_total_producto')?.value}}</td>
                    <td>
                        <button (click)="eliminarProducto(product)">
                            Eliminar
                        </button>
                    </td>
                </tr>
                <br />
            </ng-template>
        </p-table>
    </div>
    <br><br>
    <div class="summary">
        <div class="summary-item">
            <label for="iva">IVA:</label>
            <input type="text" id="iva" [(ngModel)]="iva_pedido" readonly />
        </div>
    
        <div class="summary-item">
            <label for="subtotalVenta">Subtotal Venta:</label>
            <input type="text" id="subtotalVenta" [(ngModel)]="subtotal_venta" readonly />
        </div>
    
        <div class="summary-item">
            <label for="precioTotalVenta">Precio Total Venta:</label>
            <input type="text" id="precioTotalVenta" [(ngModel)]="precio_total_venta" readonly />
        </div>
    </div>

    <div class="my-2">
        <button
            pButton
            pRipple
            label="Crear Pedido"
            icon="pi pi-user-plus"
            class="p-button-success mr-2"
            (click)="crearPedido()"
        ></button>
    </div>
</div>
